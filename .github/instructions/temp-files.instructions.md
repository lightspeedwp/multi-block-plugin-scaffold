---
name: Temporary File Management Instructions
description: Rules and standards for using the tmp/ directory
applyTo: 'tmp/**'
version: 1.0
lastUpdated: 2025-12-11
---

# Instruction: Temporary File Management

You are a temporary artefact gatekeeper. Follow our repository rules to manage `tmp/` content safely. Avoid committing temporary files, storing long-lived assets here, or adding build outputs outside reproducible processes.

## Overview

Use this guide when creating or handling files under `tmp/`. It defines what belongs there, how to name items, and how to keep the directory disposable. It does not cover build outputs stored elsewhere.

## General Rules

- Never commit files from `tmp/`; the directory is ignored and disposable.
- Store only reproducible, short-lived artefacts; avoid long-term assets.
- Organise by purpose (e.g. `tmp/reports`, `tmp/build`, `tmp/logs`).
- Keep scripts that write here idempotent and documented.

## Detailed Guidance

These instructions define the rules for managing the `tmp/` directory. This directory is strictly for temporary, auto-generated, or disposable files that should NEVER be committed to version control.

## Core Principles

1.  **Never Commit**: Files in `tmp/` MUST NEVER be committed to Git. The `tmp/` path is included in the root `.gitignore` file to enforce this.
2.  **Disposable**: Assume any file in `tmp/` can be deleted at any time without warning. Do not store important or permanent data here.
3.  **Reproducible**: Any process that generates files in `tmp/` should be repeatable. The `tmp/` directory is for transient artifacts, not sources of truth.
4.  **Organized**: Use subdirectories to categorize temporary files by their purpose (e.g., `tmp/reports`, `tmp/build`, `tmp/logs`).

## Directory Structure

The `tmp/` directory should be organized by the type of content it holds.

## Examples

- Test logs: `tmp/logs/e2e-2025-12-11.log`
- Build artefacts: `tmp/build/plugin.zip` (deleted after verification)
- Reports: `tmp/reports/audit.json` (derived, not committed)

## Validation

- Confirm `tmp/` remains in `.gitignore` and `git status` is clean after runs.
- Ensure scripts that write to `tmp/` clean up after completion.
- Verify no pipeline copies `tmp/` content into release artefacts.

```plaintext
tmp/
├── .gitkeep             # Ensures the directory is tracked by Git, but not its contents
├── README.md            # This file, explaining the purpose of tmp/
├── build/               # For temporary build artifacts, caches, or intermediate files
│   └── intermediate-asset.js
├── coverage/            # For code coverage reports (e.g., from Jest or PHPUnit)
│   ├── lcov-report/
│   └── lcov.info
├── logs/                # For temporary, verbose, or debug-level logs not intended for permanent storage
│   └── debug-session-2025-12-08.log
├── reports/             # For intermediate report data before it's finalized in .github/reports/
│   ├── analysis/
│   │   └── raw-data.json
│   └── performance/
│       └── benchmark-run-1.json
└── uploads/             # For temporary file uploads during testing or development
    └── test-image.jpg
```

### Key Subdirectories

| Directory | Purpose | Example Files | Cleanup |
| :--- | :--- | :--- | :--- |
| `build/` | Intermediate build files, caches. | Webpack cache, intermediate bundles. | Cleaned on each `npm run build`. |
| `coverage/` | Code coverage reports. | `lcov.info`, HTML reports. | Generated by `npm run test:coverage`. |
| `logs/` | Volatile or debug logs. | `debug-*.log`, `session-*.log`. | Manual or script-based. |
| `reports/` | Raw data for report generation. | `raw-data.json`, `benchmark.csv`. | Script should clean up after final report is generated. |
| `uploads/` | Temporary file uploads for local dev. | `test.zip`, `image.png`. | Manual. |

## Rules for Scripts and Agents

Any automated process, script, or AI agent that uses the `tmp/` directory must adhere to the following rules.

### Generation

1.  **Create Subdirectory**: Before writing files, create a unique and descriptive subdirectory within `tmp/`. Use a timestamp or process ID to avoid conflicts.
    ```javascript
    const path = require('path');
    const fs = require('fs');
    const timestamp = new Date().toISOString().replace(/:/g, '-');
    const tempReportDir = path.join(__dirname, '../../tmp/reports/analysis', timestamp);
    fs.mkdirSync(tempReportDir, { recursive: true });
    ```

2.  **Write Files**: Place all temporary output within this dedicated subdirectory.

### Processing

1.  **Read from `tmp/`**: Scripts can read data from `tmp/` to perform tasks (e.g., generating a final report).
2.  **Write to Permanent Location**: The final output should be saved to a permanent location (e.g., `.github/reports/`, `dist/`, `logs/`).

### Cleanup

1.  **Self-Cleanup**: A script that creates a temporary directory in `tmp/` is responsible for deleting it upon successful completion.
    ```javascript
    // After the script has finished its work...
    try {
      fs.rmSync(tempReportDir, { recursive: true, force: true });
      console.log(`Cleaned up temporary directory: ${tempReportDir}`);
    } catch (error) {
      console.error(`Failed to clean up temporary directory: ${error.message}`);
    }
    ```

2.  **Error Handling**: Cleanup should occur in a `finally` block or equivalent to ensure it runs even if the script encounters an error.

## .gitignore Enforcement

The root `.gitignore` file contains entries to prevent the contents of `tmp/` from being committed.

```gitignore
# .gitignore

# Temporary files and logs
/tmp/*
!/tmp/.gitkeep
!/tmp/README.md

/logs/*
!/logs/.gitkeep
!/logs/README.md
```

-   `/tmp/*`: Ignores all files and folders directly inside `tmp/`.
-   `!/tmp/.gitkeep`: Un-ignores the `.gitkeep` file, so the empty `tmp` directory can be part of the repository structure.
-   `!/tmp/README.md`: Un-ignores this documentation file.

**CRITICAL**: Do not ever use `git add --force tmp/some-file.log` to bypass these rules.

## Summary

✅ **DO**:
- Use `tmp/` for files you don't want to commit.
- Create organized subdirectories for your temporary files.
- Write scripts that clean up their own temporary directories.
- Assume anything in `tmp/` can be deleted.

❌ **DO NOT**:
- Commit any files or directories to `tmp/` (other than `.gitkeep` and `README.md`).
- Store any important, permanent, or source-of-truth data in `tmp/`.
- Rely on the contents of `tmp/` being present between script executions.

## References

- [reporting.instructions.md](./reporting.instructions.md) – `tmp/reports/` staging guidance
- [logs/README.md](../../logs/README.md) – log vs temporary file handling
- [.gitignore](../../.gitignore) – ignored paths
- [folder-structure.instructions.md](./folder-structure.instructions.md)
